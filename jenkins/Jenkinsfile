pipeline{
    agent any
    environment {
        PATH = "$PATH:/usr/share/maven"
    }
    stages{
       stage('image_build'){
            steps{
                sh '''
                    echo "buildinng image"
                    docker image build -t sonarimg ${WORKSPACE}/docker
                    '''
            }
        }
        stage('Build'){
            steps{
                sh 'mvn clean package'
            }
        }
        stage('SonarQube analysis') {
            steps{
                withSonarQubeEnv('sonarqube-server'){
                sh 'mvn clean install sonar:sonar -Dsonar.projectKey=NewProject'
                }
            }
        }
        stage('image_tagging'){
            steps{
                sh '''
                    echo "taggig image"
                    docker image tag sonarimg:latest ranjana000/sonarimg:latest
                    '''
            }
        }
        stage('image_push'){
            steps{
                sh '''
                    docker login -u ranjana000 -p shrinidhi@1
                    docker image push ranjana000/sonarimg:latest
                    '''
            }
        }
        stage('deploy'){
             steps{
                sh '''
                    echo "creating container..."
                    docker container run -d --name container3 ranjana000/sonarimg:latest bash
                    '''
            }
        }
    }
    post {
        always {
            // Configure Maven to register binaries with SonarQube
            withSonarQubeEnv('soarqube-server') {
                sh 'mvn sonar:deploy'
            }
        }
    }

}

